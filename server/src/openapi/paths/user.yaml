avatar:
  put:
    tags:
      - user
    summary: Update user avatar
    description: |
      Upload a new avatar image for the authenticated user.

      **Workflow:**
      1. Frontend: User selects image and previews it locally (no server call)
      2. Frontend: User clicks "Save" to confirm
      3. Backend: Validates file, uploads to Cloudinary with optimizations, saves URL to database
      4. Backend: Automatically deletes old avatar from Cloudinary

      **Image Processing:**
      - Resized to 400x400 pixels
      - Face detection and centering applied
      - Automatic quality and format optimization (WebP for modern browsers)
      - Stored in Cloudinary with secure URL
    operationId: updateUserAvatar
    security:
      - cookieAuth: []
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            required:
              - avatar
            properties:
              avatar:
                type: string
                format: binary
                description: Avatar image file (JPEG, PNG, GIF, or WebP). Maximum size 2MB.
    responses:
      "200":
        description: Avatar updated successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: "Avatar updated successfully"
                data:
                  type: object
                  properties:
                    avatar_url:
                      type: string
                      format: uri
                      example: "https://res.cloudinary.com/demo/image/upload/v1234567890/user_avatars/avatar_123_1234567890.jpg"
                      description: "Cloudinary URL of the uploaded avatar image"
      "400":
        description: Bad request - Avatar file is required or invalid file type
        content:
          application/json:
            schema:
              $ref: "../schemas/auth.yaml#/ErrorResponse"
            examples:
              noFile:
                value:
                  success: false
                  message: "Avatar image is required"
              invalidType:
                value:
                  success: false
                  message: "Only image files (JPEG, PNG, GIF, WebP) are allowed"
              sizeTooLarge:
                value:
                  success: false
                  message: "File size exceeds 2MB limit"
      "401":
        description: Unauthorized - User not authenticated
        content:
          application/json:
            schema:
              $ref: "../schemas/auth.yaml#/ErrorResponse"
            example:
              success: false
              message: "Unauthorized - User not authenticated"
      "500":
        description: Internal server error
        content:
          application/json:
            schema:
              $ref: "../schemas/auth.yaml#/ErrorResponse"
            example:
              success: false
              message: "Internal server error"

change-password:
  put:
    tags:
      - user
    summary: Change user password
    description: |
      Change the password for the authenticated user.

      **Requirements:**
      - User must be authenticated with a valid JWT token
      - User must be using local authentication (not Google OAuth)
      - Old password must be correct
      - New password must be different from old password
      - New password must match confirm password
      - Password must be 8-20 characters long

      **Workflow:**
      1. User provides current password for verification
      2. User provides new password and confirmation
      3. Backend validates old password against database
      4. Backend hashes new password and updates database
      5. User can immediately login with new password
    operationId: changeUserPassword
    security:
      - cookieAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../schemas/auth.yaml#/ChangePasswordRequest"
    responses:
      "200":
        description: Password changed successfully
        content:
          application/json:
            schema:
              $ref: "../schemas/auth.yaml#/SuccessResponse"
            example:
              success: true
              message: "Password changed successfully"
      "400":
        description: Bad request - Validation errors or incorrect old password
        content:
          application/json:
            schema:
              oneOf:
                - $ref: "../schemas/auth.yaml#/ErrorResponse"
                - $ref: "../schemas/auth.yaml#/ValidationErrorResponse"
            examples:
              incorrectOldPassword:
                value:
                  success: false
                  message: "Current password is incorrect"
              googleUser:
                value:
                  success: false
                  message: "Cannot change password for Google authenticated users"
              validationErrors:
                value:
                  success: false
                  message: "Validation errors"
                  data:
                    errors:
                      - "New password and confirm password do not match: confirmPassword"
                      - "New password must be different from old password: newPassword"
              passwordTooShort:
                value:
                  success: false
                  message: "Validation errors"
                  data:
                    errors:
                      - "Password must be at least 8 characters long: newPassword"
      "401":
        description: Unauthorized - User not authenticated
        content:
          application/json:
            schema:
              $ref: "../schemas/auth.yaml#/ErrorResponse"
            example:
              success: false
              message: "Unauthorized - User not authenticated"
      "500":
        description: Internal server error
        content:
          application/json:
            schema:
              $ref: "../schemas/auth.yaml#/ErrorResponse"
            example:
              success: false
              message: "Internal server error"
